@using Microsoft.EntityFrameworkCore.Metadata.Internal
@model List<MainGorevUygulama.Models.Mission>
<title>Missions</title>
<div class="container mt-5 pt-4">
    <div class="row">
        <!-- Yapılacaklar -->
        <div class="col-md-6">
            <h4 class="mb-4">📋 To Do</h4>
            <div class="task-container" id="incomplete-tasks">
                @if (!Model.Any())
                {
                    <div class="empty-state text-center p-5">
                        <i data-feather="inbox" class="mb-3"></i>
                        <p class="text-muted">No missions yet. Add your first one 🚀</p>
                    </div>
                }
                else
                {
                    @foreach (var item in Model)
                    {
                        <div class="task-card d-flex justify-content-between align-items-center mb-3 p-4 shadow-sm rounded @(item.Statu ? "completed" : "")">
                            <div class="d-flex align-items-center">
                                <form asp-controller="Task" asp-action="MissionStatus" method="post" class="task-form">
                                    <input type="hidden" name="Id" value="@item.Id" />
                                    <input type="hidden" name="Statu" value="@item.Statu" /> <!-- JS ile güncellenecek -->
                                    <input type="checkbox" class="form-check-input me-3 task-complete-btn"
                                           @(item.Statu ? "checked=\"checked\"" : "") />
                                </form>

                                <div>
                                    <h6 class="mb-1 fw-bold">@item.Title</h6>
                                    <p class="mb-1 text-muted small">@item.Description</p>
                                    <small class="text-secondary">
                                        <i data-feather="calendar" class="me-1"></i>
                                        @item.Date.ToString("dddd, dd MMMM - HH:mm")
                                    </small>
                                </div>
                            </div>

                            <div class="d-flex">
                                <form asp-action="UpdateMission" asp-route-id="@item.Id" method="get" class="ms-2">
                                    <button type="submit" class="btn btn-sm btn-outline-warning">✏️</button>
                                </form>
                                <form asp-action="DeleteMission" asp-route-id="@item.Id" method="post" class="ms-2">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">🗑️</button>
                                </form>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <!-- Tamamlananlar -->
        <div class="col-md-6">
            <h4 class="mb-4">✅ Completed</h4>
            <div class="task-container" id="completed-tasks"></div>
        </div>
    </div>

    <div class="button-container mt-4 text-center">
        <a href="/Task/AddMission" class="btn btn-gradient btn-lg">➕ Add Mission</a>
    </div>
</div>

<head>
    <link rel="stylesheet" href="~/css/MainPage.css" asp-append-version="true" />
</head>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const completedContainer = document.querySelector("#completed-tasks");
        const todoContainer = document.querySelector("#incomplete-tasks");

        document.querySelectorAll(".task-card").forEach(card => {
            const form = card.querySelector(".task-form");
            const checkbox = card.querySelector(".task-complete-btn");
            const hidden = form.querySelector('input[name="Statu"]');

            // Sayfa açılırken checked olanlar Completed container’a taşı
            if (checkbox.checked) {
                completedContainer.appendChild(card);
            }

            checkbox.addEventListener("change", (e) => {
                e.preventDefault(); // formun default submit’ini durdur

                hidden.value = checkbox.checked; // true/false set

                // Kartı taşımadan önce efekt
                card.style.transition = "all 0.3s ease";
                card.style.opacity = "0.5";
                setTimeout(() => {
                    if (checkbox.checked) {
                        card.classList.add("completed");
                        completedContainer.appendChild(card);
                    } else {
                        card.classList.remove("completed");
                        todoContainer.appendChild(card);
                    }
                    card.style.opacity = "1";
                }, 50);

                // AJAX ile backend’e gönder
                fetch(form.action, {
                    method: "POST",
                    body: new FormData(form)
                });
            });
        });

        feather.replace();
    });
</script>

